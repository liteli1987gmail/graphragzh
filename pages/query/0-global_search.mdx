


---
title: å…¨å±€æœç´¢ ğŸ”
navtitle: å…¨å±€æœç´¢
tags: [post, ç¼–æ’]
layout: page
date: 2024-06-03
---

# å…¨å±€æœç´¢ ğŸ”

## æ•´ä¸ªæ•°æ®é›†çš„æ¨ç†

åŸºå‡†çš„ RAG å¯¹äºéœ€è¦å¯¹æ•°æ®é›†ä¸­çš„ä¿¡æ¯è¿›è¡Œèšåˆä»¥ç»„æˆç­”æ¡ˆçš„æŸ¥è¯¢å¾ˆéš¾å¤„ç†ã€‚åƒâ€œæ•°æ®ä¸­å‰ 5 ä¸ªä¸»é¢˜æ˜¯ä»€ä¹ˆï¼Ÿâ€è¿™æ ·çš„æŸ¥è¯¢è¡¨ç°éå¸¸ç³Ÿç³•ï¼Œå› ä¸ºåŸºå‡†çš„ RAG ä¾èµ–äºå¯¹æ•°æ®é›†ä¸­è¯­ä¹‰ç›¸ä¼¼æ–‡æœ¬å†…å®¹çš„å‘é‡æœç´¢ã€‚æŸ¥è¯¢ä¸­æ²¡æœ‰ä»»ä½•æŒ‡ç¤ºå®ƒæ‰¾åˆ°æ­£ç¡®ä¿¡æ¯çš„å†…å®¹ã€‚

ç„¶è€Œï¼Œä½¿ç”¨ GraphRAGï¼Œæˆ‘ä»¬å¯ä»¥å›ç­”è¿™æ ·çš„é—®é¢˜ï¼Œå› ä¸º LLM ç”Ÿæˆçš„çŸ¥è¯†å›¾çš„ç»“æ„å‘Šè¯‰æˆ‘ä»¬æ•´ä¸ªæ•°æ®é›†çš„ç»“æ„ï¼ˆå› æ­¤ä¹Ÿæ˜¯ä¸»é¢˜ï¼‰ã€‚è¿™ä½¿å¾—ç§æœ‰æ•°æ®é›†å¯ä»¥è¢«ç»„ç»‡æˆæœ‰æ„ä¹‰çš„è¯­ä¹‰èšç±»ï¼Œå¹¶è¿›è¡Œé¢„æ‘˜è¦ã€‚ä½¿ç”¨æˆ‘ä»¬çš„ [å…¨å±€æœç´¢](https://github.com/microsoft/graphrag/blob/main//graphrag/query/structured_search/global_search/) æ–¹æ³•ï¼ŒLLM åœ¨å“åº”ç”¨æˆ·æŸ¥è¯¢æ—¶ä½¿ç”¨è¿™äº›èšç±»æ¥æ€»ç»“è¿™äº›ä¸»é¢˜ã€‚

## æ–¹æ³•è®º

![æµç¨‹å›¾](/img/globalsearch.png)

æ ¹æ®ç”¨æˆ·æŸ¥è¯¢å’Œå¯é€‰çš„å¯¹è¯å†å²ï¼Œå…¨å±€æœç´¢æ–¹æ³•ä½¿ç”¨ä¸€ç³»åˆ—æ¥è‡ªå›¾çš„ç¤¾åŒºå±‚æ¬¡ç»“æ„ä¸­æŒ‡å®šçº§åˆ«çš„ç¤¾åŒºæŠ¥å‘Šä½œä¸ºä¸Šä¸‹æ–‡æ•°æ®ï¼Œä»¥æ˜ å°„-å‡å°‘çš„æ–¹å¼ç”Ÿæˆå“åº”ã€‚åœ¨ `map` æ­¥éª¤ä¸­ï¼Œå°†ç¤¾åŒºæŠ¥å‘Šåˆ†å‰²æˆé¢„å®šä¹‰å¤§å°çš„æ–‡æœ¬å—ã€‚ç„¶åï¼Œä½¿ç”¨æ¯ä¸ªæ–‡æœ¬å—ç”Ÿæˆä¸€ä¸ªåŒ…å«ä¸€ç³»åˆ—å…·æœ‰é™„å¸¦çš„æ•°å€¼è¯„çº§çš„ç‚¹çš„ä¸­çº§å›åº”ã€‚åœ¨ `reduce` æ­¥éª¤ä¸­ï¼Œä»ä¸­çº§å›åº”ä¸­ç­›é€‰å‡ºä¸€ç»„æœ€é‡è¦çš„ç‚¹ï¼Œå¹¶å°†å…¶èšåˆä½¿ç”¨ä½œä¸ºä¸Šä¸‹æ–‡æ¥ç”Ÿæˆæœ€ç»ˆçš„å“åº”ã€‚

å…¨å±€æœç´¢çš„å“åº”è´¨é‡å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºæ‰€é€‰çš„ç”¨äºè·å–ç¤¾åŒºæŠ¥å‘Šçš„ç¤¾åŒºå±‚æ¬¡ç»“æ„çº§åˆ«ã€‚è¾ƒä½å±‚æ¬¡çš„å±‚æ¬¡ç»“æ„å¸¦æœ‰å…¶è¯¦ç»†æŠ¥å‘Šï¼Œå¾€å¾€ä¼šäº§ç”Ÿæ›´è¯¦å°½çš„å“åº”ï¼Œä½†å¯èƒ½ä¹Ÿä¼šå¢åŠ ç”Ÿæˆæœ€ç»ˆå“åº”æ‰€éœ€çš„æ—¶é—´å’Œ LLM èµ„æºï¼Œå› ä¸ºéœ€è¦å¤„ç†æ›´å¤šçš„æŠ¥å‘Šã€‚

## é…ç½®

ä¸‹é¢æ˜¯ [GlobalSearch ç±»](https://github.com/microsoft/graphrag/blob/main//graphrag/query/structured_search/global_search/search.py) çš„å…³é”®å‚æ•°ï¼š
* `llm`ï¼šç”¨äºå“åº”ç”Ÿæˆçš„ OpenAI æ¨¡å‹å¯¹è±¡
* `context_builder`ï¼šç”¨äºä»ç¤¾åŒºæŠ¥å‘Šä¸­å‡†å¤‡ä¸Šä¸‹æ–‡æ•°æ®çš„ [ä¸Šä¸‹æ–‡æ„å»ºå™¨](https://github.com/microsoft/graphrag/blob/main//graphrag/query/structured_search/global_search/community_context.py) å¯¹è±¡
* `map_system_prompt`ï¼š`map` é˜¶æ®µä½¿ç”¨çš„æç¤ºæ¨¡æ¿ã€‚é»˜è®¤æ¨¡æ¿å¯ä»¥åœ¨ [map_system_prompt](https://github.com/microsoft/graphrag/blob/main//graphrag/query/structured_search/global_search/map_system_prompt.py) ä¸­æ‰¾åˆ°
* `reduce_system_prompt`ï¼š`reduce` é˜¶æ®µä½¿ç”¨çš„æç¤ºæ¨¡æ¿ã€‚é»˜è®¤æ¨¡æ¿å¯ä»¥åœ¨ [reduce_system_prompt](https://github.com/microsoft/graphrag/blob/main//graphrag/query/structured_search/global_search/reduce_system_prompt.py) ä¸­æ‰¾åˆ°
* `response_type`ï¼šæè¿°æ‰€éœ€å“åº”ç±»å‹å’Œæ ¼å¼çš„è‡ªç”±æ–‡æœ¬ï¼ˆä¾‹å¦‚ï¼Œ`å¤šæ®µè½`ï¼Œ`å¤šé¡µæŠ¥å‘Š`ï¼‰
* `allow_general_knowledge`ï¼šå°†å…¶è®¾ç½®ä¸º True å°†åœ¨ `reduce_system_prompt` ä¸­æ·»åŠ é¢å¤–çš„æŒ‡ä»¤ï¼Œæç¤º LLM åœ¨æ•°æ®é›†ä»¥å¤–çš„ç›¸å…³çœŸå®ä¸–ç•ŒçŸ¥è¯†ã€‚è¯·æ³¨æ„ï¼Œè¿™å¯èƒ½ä¼šå¢åŠ å‡­ç©ºè™šæ„çš„å¯èƒ½æ€§ï¼Œä½†å¯¹äºæŸäº›åœºæ™¯å¯èƒ½å¾ˆæœ‰ç”¨ã€‚é»˜è®¤å€¼ä¸º False
* `general_knowledge_inclusion_prompt`ï¼šå¦‚æœå¯ç”¨äº† `allow_general_knowledge`ï¼Œåˆ™æ·»åŠ åˆ° `reduce_system_prompt` ä¸­çš„æŒ‡ä»¤ã€‚é»˜è®¤æŒ‡ä»¤å¯ä»¥åœ¨ [general_knowledge_instruction](https://github.com/microsoft/graphrag/blob/main//graphrag/query/structured_search/global_search/reduce_system_prompt.py) ä¸­æ‰¾åˆ°
* `max_data_tokens`ï¼šä¸Šä¸‹æ–‡æ•°æ®çš„ä»¤ç‰Œé¢„ç®—
* `map_llm_params`ï¼šä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«å°†åœ¨ `map` é˜¶æ®µä¼ é€’ç»™ LLM è°ƒç”¨çš„å…¶ä»–å‚æ•°ï¼ˆä¾‹å¦‚ï¼Œtemperatureï¼Œmax_tokensï¼‰
* `reduce_llm_params`ï¼šä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«å°†åœ¨ `reduce` é˜¶æ®µä¼ é€’ç»™ LLM è°ƒç”¨çš„å…¶ä»–å‚æ•°ï¼ˆä¾‹å¦‚ï¼Œtemperatureï¼Œmax_tokensï¼‰
* `context_builder_params`ï¼šä¸€ä¸ªå­—å…¸ï¼Œç”¨äºåœ¨ `map` é˜¶æ®µæ„å»ºä¸Šä¸‹æ–‡çª—å£æ—¶ä¼ é€’ç»™ [`context_builder`](https://github.com/microsoft/graphrag/blob/main//graphrag/query/structured_search/global_search/community_context.py) å¯¹è±¡çš„å…¶ä»–å‚æ•°ã€‚
* `concurrent_coroutines`ï¼šæ§åˆ¶ `map` é˜¶æ®µçš„å¹¶è¡Œç¨‹åº¦ã€‚
* `callbacks`ï¼šå¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œå¯ç”¨äºä¸º LLM çš„å®Œæˆæµäº‹ä»¶æä¾›å®šåˆ¶çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚


ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¨å±€æœç´¢åœºæ™¯çš„ç¤ºä¾‹ï¼Œå¯ä»¥åœ¨ä»¥ä¸‹ [notebook](https://microsoft.github.io/graphrag/posts/query/notebooks/global_search_nb/) ä¸­æ‰¾åˆ°ã€‚ 